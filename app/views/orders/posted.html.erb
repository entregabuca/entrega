<p id="notice"><%= notice %></p>

<h1>Orders</h1>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Sender</th>
      <th>Company</th>
      <th>Transporter</th>
      <th>Status</th>
      <th>Description</th>
      <th>Weight</th>
      <th>Length</th>
      <th>Width</th>
      <th>Heigth</th>
      <th>PickUp address</th>
      <th>PickUp Coordinates</th>
      <th>PickUp Time</th>
      <th>Delivery address</th>
      <th>Delivery Coordinates</th>
      <th>Delivery Time</th>
      <th>Cost</th>      
      <th>Radius</th>
      <% if @user.class.name == ('Company'   || 'Transporter') %>
        <th>Distance to Order</th>
      <% end %>
      <th colspan="3"></th>
     
    </tr>
  </thead>

  <tbody>
    <% @orders.each do |order| %>
      <tr>
        <td><%= order.sender.name %></td>
        <td><%= order.transporter.present? ? order.transporter.company.name : "-" %></td>
        <td><%= order.transporter.present? ? order.transporter.name : "-" %></td>
        <td><%= order.status.present? ? order.status.capitalize : "-"  %></td>
        <td><%= order.description %></td>
        <td><%= order.weight %></td>
        <td><%= order.length %></td>
        <td><%= order.width %></td>
        <td><%= order.heigth %></td>
        <td><%= address(order,0) %></td>
        <td><%= coordinates(order,0).to_dms %></td> 
        <td><%= order.pickup_time %></td>
        <td><%= address(order,1) %></td>
        <td><%= coordinates(order,0).to_dms %></td>
        <td><%= order.delivery_time %></td>
        <td><%= number_with_delimiter(order.cost.to_i) %></td>
        <td><%= number_with_delimiter(order.radius) %></td>

        
<% if @user.class.name == ('Company'  || 'Transporter') %>
          <td><%= @user.class.name == 'Company' ? number_with_delimiter(( \
                Geocoder::Calculations.distance_between( \
                [@user.locations[0].latitude,@user.locations[0].longitude], \
                [order.locations[0].latitude,order.locations[0].longitude])*1000).to_i) : "-"%></td>
        <% end %>

        <td><%= link_to url_for([@user, order]) do %><span class="fa fa-eye"></span><% end %></td>

        <% if @user.class.name == "Company" && ['posted','taken', 'inTransit'].include?(order.status) %>          
          <td><%= link_to url_for([:edit, @user, order]) do %><span class="fa fa-edit"></span><% end %></td>
          <td></td> 

        <% elsif @user.class.name == "Sender" && order.status == 'draft'  %>
          <td><%= link_to url_for([:edit, @user, order]) do %><span class="fa fa-edit"></span><% end %></td>
           <td><%= link_to url_for([@user, order]), method: :delete, data: { confirm: 'Are you sure?' } do %><span class="fa fa-trash"></span><% end %></td>
           

        <% elsif @user.class.name == "Sender" && ['completed', 'cancelled'].include?(order.status) %>
          <td><%= link_to url_for([@user, order]), method: :delete, data: { confirm: 'Are you sure?' } do %><span class="fa fa-trash"></span><% end %></td>
          <td></td>

        <% else %>
          <td></td>
          <td></td>
          

        <% end %>            
      </tr>
    <% end %>

<%#= render 'distanceAndActions', order: @order %>
        
  </tbody>
</table>